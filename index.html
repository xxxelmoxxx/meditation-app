<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>呼吸瞑想アプリ</title>

<style>
body{
  font-family: system-ui,sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
.container{
  width:360px;
  background:rgba(255,255,255,.15);
  padding:24px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
}
h1{text-align:center;margin-bottom:20px}

.settings{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
label{font-size:14px}
.value{color:#38bdf8;font-weight:bold}

input[type=range]{width:100%}

#circle{
  width:180px;height:180px;
  margin:24px auto;
  border-radius:50%;
  background:#38bdf8;
  transition:transform linear;
}

#instruction{
  text-align:center;
  font-size:20px;
  min-height:48px;
}

button{
  width:45%;
  padding:12px;
  border:none;
  border-radius:24px;
  font-size:16px;
  cursor:pointer;
}
#start{background:#22c55e;color:#fff}
#stop{background:#6b7280;color:#fff}

audio{width:100%;margin-top:12px}
</style>
</head>

<body>
<div class="container">
<h1>呼吸瞑想アプリ</h1>

<div class="settings">
  <div>
    <label>吸う（秒）</label>
    <input id="inhale" type="range" min="2" max="10" value="4">
    <div class="value" id="inhaleVal">4秒</div>
  </div>
  <div>
    <label>吐く（秒）</label>
    <input id="exhale" type="range" min="4" max="12" value="6">
    <div class="value" id="exhaleVal">6秒</div>
  </div>
</div>

<audio id="bgm" src="music/bgm.mp3" preload="auto" controls></audio>

<div id="circle"></div>
<div id="instruction">準備ができたら開始</div>

<div style="display:flex;justify-content:space-between">
  <button id="start">開始</button>
  <button id="stop">停止</button>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const inhale=document.getElementById("inhale");
const exhale=document.getElementById("exhale");
const inhaleVal=document.getElementById("inhaleVal");
const exhaleVal=document.getElementById("exhaleVal");
const circle=document.getElementById("circle");
const instruction=document.getElementById("instruction");
const bgm=document.getElementById("bgm");

let timer=null;
let running=false;

/* 秒数表示 */
function updateValues(){
  inhaleVal.textContent=inhale.value+"秒";
  exhaleVal.textContent=exhale.value+"秒";
}
inhale.oninput=updateValues;
exhale.oninput=updateValues;
updateValues();

/* 合図音 */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(freq=440,duration=0.15){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=freq;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+duration);
  o.stop(audioCtx.currentTime+duration);
}

/* 呼吸1サイクル */
function cycle(){
  if(!running) return;

  const inhaleMs=inhale.value*1000;
  const exhaleMs=exhale.value*1000;

  instruction.textContent="吸って";
  beep(220); // 吸う
  circle.style.transitionDuration=inhaleMs+"ms";
  circle.style.transform="scale(1.4)";

  timer=setTimeout(()=>{
    instruction.textContent="止める";
    beep(880); // 止め
    timer=setTimeout(()=>{
      instruction.textContent="吐いて";
      beep(160); // 吐く
      circle.style.transitionDuration=exhaleMs+"ms";
      circle.style.transform="scale(0.7)";

      timer=setTimeout(()=>{
        instruction.textContent="止める";
        beep(880);
        timer=setTimeout(cycle,2000);
      },exhaleMs);

    },2000);
  },inhaleMs);
}

/* 開始・停止 */
document.getElementById("start").onclick=()=>{
  if(running) return;
  running=true;
  bgm.play().catch(()=>{});
  cycle();
};

document.getElementById("stop").onclick=()=>{
  running=false;
  clearTimeout(timer);
  instruction.textContent="停止しました";
  circle.style.transform="scale(1)";
  bgm.pause();
};

});
</script>
</body>
</html>
